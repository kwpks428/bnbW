# BNB Historical Crawler

BNB 預測遊戲歷史數據抓取服務 - 專門處理歷史數據回補和數據完整性檢查。

## 功能特點

- **雙線架構**：主線深度回補歷史數據，支線檢查最近5局數據完整性
- **自動重啟**：主線每30分鐘執行優雅重啟，確保持續運行
- **數據驗證**：完整的數據完整性檢查和驗證機制
- **錯誤處理**：失敗重試機制和失敗記錄管理
- **性能優化**：請求限速和批量數據處理

## 安裝與配置

1. 安裝依賴：
```bash
npm install
```

2. 配置環境變量：
```bash
cp .env.example .env
# 編輯 .env 文件，設置正確的配置值
```

3. 初始化數據庫：
```bash
# 執行 init-database.sql 來創建必要的表結構
```

## 運行

### 開發模式
```bash
npm run dev
```

### 生產模式
```bash
npm start
```

## 環境變量說明

- `DATABASE_URL`: PostgreSQL 數據庫連接字符串
- `RPC_HTTP_URL`: BSC HTTP RPC 節點地址
- `RPC_WS_URL`: BSC WebSocket RPC 節點地址
- `RPC_BACKUP_URLS`: 備用 HTTP RPC 節點地址（逗號分隔）
- `CONTRACT_ADDRESS`: 預測遊戲智能合約地址

## Railway 部署

本項目已配置為可直接部署到 Railway 平台。部署時請確保設置正確的環境變量。

## 監控與統計

服務運行時會每30秒輸出處理統計信息：
- 已處理局次數量
- 已處理下注數量  
- 已處理領獎數量
- 錯誤次數

## 架構說明

### 主線處理
- 從當前局次向前回補歷史數據
- 每30分鐘執行優雅重啟
- 跳過已有數據的局次

### 支線處理  
- 每5分鐘檢查最近5局數據完整性
- 補充缺失的數據
- 5分鐘後啟動，避免與主線衝突